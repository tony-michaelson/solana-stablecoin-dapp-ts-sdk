import { PriceHistoryAccountLayout, PriceHistoryStructure } from './layout'

describe('OracleAccount', () => {
  const priceHistory: PriceHistoryStructure = {
    metadata: {
      version: 0,
      dataType: 14,
      isInitialized: true,
      extraInfo: [0, 0, 0, 0, 0],
    },
    prices: [
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
      {
        solPrice: BigInt(0),
        lucraPrice: BigInt(0),
        date: BigInt(0),
        solDecimals: 0,
        lucraDecimals: 0,
        padding: [0, 0, 0, 0, 0, 0],
      },
    ],
    intervalStart: BigInt(1664312280),
    lastUpdateTimestamp: BigInt(0),
    updateCounter: 0,
    padding: Array.from(Array(132).keys()).map(() => 0),
  }

  const encodedData = Buffer.from(
    new Uint8Array([
      0, 14, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 216, 99, 51, 99,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ])
  )

  it('encodes an PriceHistoryAccount object properly', () => {
    const encoded = Buffer.alloc(PriceHistoryAccountLayout.span)
    PriceHistoryAccountLayout.encode(priceHistory, encoded)
    expect(encoded).toStrictEqual(encodedData)
  })

  it('decodes a Uint8Array properly', () => {
    const decoded = PriceHistoryAccountLayout.decode(encodedData)

    expect(decoded.metadata.version).toStrictEqual(
      priceHistory.metadata.version
    )
    expect(decoded.metadata.dataType).toStrictEqual(
      priceHistory.metadata.dataType
    )
    expect(decoded.metadata.isInitialized).toStrictEqual(
      priceHistory.metadata.isInitialized
    )
    expect(decoded.metadata.extraInfo).toStrictEqual(
      priceHistory.metadata.extraInfo
    )

    for (let i = 0; i < 30; i++) {
      expect(decoded.prices[i]?.date.toString()).toStrictEqual(
        priceHistory.prices[i]?.date.toString()
      )
      expect(decoded.prices[i]?.lucraDecimals.toString()).toStrictEqual(
        priceHistory.prices[i]?.lucraDecimals.toString()
      )
      expect(decoded.prices[i]?.lucraPrice.toString()).toStrictEqual(
        priceHistory.prices[i]?.lucraPrice.toString()
      )
      expect(decoded.prices[i]?.solDecimals.toString()).toStrictEqual(
        priceHistory.prices[i]?.solDecimals.toString()
      )
      expect(decoded.prices[i]?.solPrice.toString()).toStrictEqual(
        priceHistory.prices[i]?.solPrice.toString()
      )
      expect(decoded.prices[i]?.padding.toString()).toStrictEqual(
        priceHistory.prices[i]?.padding.toString()
      )
    }

    expect(decoded.intervalStart.toString()).toStrictEqual(
      priceHistory.intervalStart.toString()
    )
    expect(decoded.lastUpdateTimestamp.toString()).toStrictEqual(
      priceHistory.lastUpdateTimestamp.toString()
    )
    expect(decoded.updateCounter.toString()).toStrictEqual(
      priceHistory.updateCounter.toString()
    )

    expect(decoded.padding).toStrictEqual(priceHistory.padding)
  })
})
